<!DOCTYPE html>
<html lang="en, cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">
  <meta name="msapplication-config" content="/images/browserconfig.xml">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shuoo-24.github.io","root":"/","scheme":"Gemini","version":"8.0.0","exturl":false,"sidebar":{"position":"left","Pisces | Gemini":240,"padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta name="description" content="References:  ã€å‚è€ƒ 1ã€‘: The RISC-V Instruction Set Manual, Volume I: Unprivileged ISA, Document Version 20191213 ã€å‚è€ƒ 2ã€‘: Using as: https:&#x2F;&#x2F;sourceware.org&#x2F;binutils&#x2F;docs&#x2F;as&#x2F; ã€å‚è€ƒ 3ã€‘: How to Use Inline Asse">
<meta property="og:type" content="article">
<meta property="og:title" content="RISC-V Instruction Overview">
<meta property="og:url" content="http://shuoo-24.github.io/2021/06/30/hello-world/index.html">
<meta property="og:site_name" content="Shuoçš„ç©ºé—´ç«™">
<meta property="og:description" content="References:  ã€å‚è€ƒ 1ã€‘: The RISC-V Instruction Set Manual, Volume I: Unprivileged ISA, Document Version 20191213 ã€å‚è€ƒ 2ã€‘: Using as: https:&#x2F;&#x2F;sourceware.org&#x2F;binutils&#x2F;docs&#x2F;as&#x2F; ã€å‚è€ƒ 3ã€‘: How to Use Inline Asse">
<meta property="og:locale">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5he6eo1mj30xc0i8tku.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5fcais71j30wq0h4gys.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gs5fnyma1ij310o0kajx2.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7qudka3vj30jy0huq6b.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7qulweclj30ji068jsm.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5gduzha0j31220l6djh.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5gej2nfej310e0hajut.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gs5gg1g2o8j60zi0fsqdf02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5gr6txumj31040joqcz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5h1c25qbj30xa06mjs7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5h34mr9lj30wq03emxl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5h5fkiuwj30wg09iwh4.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jf9er3uj31000gkgrh.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7j9rfyv1j30zk07qdgz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7k2cigqrj319e06i0ya.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jdpwn7ij30rs0a4dhg.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jidrvq4j30yo06u764.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jtma6ngj31380ay41w.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jb34hw9j310i0pm10o.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7ka4caqhj30t806g3z6.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kar8s5kj30s80300tr.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gs7kifvy3nj30qy03it96.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kiwsgy9j30rq066dgi.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kd2qphzj30r20ekgon.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kdbv5y0j30r209w0tr.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7lfqfncbj30yi04wdge.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7lyaw09sj30x6058gm7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7r27qrlfj30r209imyo.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7r0a6qpkj30is0rojxv.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7k122fq5j30nq03sab2.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gs5f2f5ei6j314c0io7dz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5hhxrn4sj30uw0cwn3r.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs6ai5jp36j30xs0dmdjl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs9xhfvc1oj31020c0ady.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7e4qwbp0j30zm0ckgry.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs6f456bcij310a0dc0yo.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs7egavjmsj30wq0g4qbr.jpg">
<meta property="article:published_time" content="2021-06-30T10:23:04.672Z">
<meta property="article:modified_time" content="2021-07-17T20:41:23.750Z">
<meta property="article:author" content="Shuo">
<meta property="article:tag" content="Computer Architecture">
<meta property="article:tag" content="RISC-V">
<meta property="article:tag" content="ISA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gs5he6eo1mj30xc0i8tku.jpg">


<link rel="canonical" href="http://shuoo-24.github.io/2021/06/30/hello-world/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en, cn'
  };
</script>

  <title>RISC-V Instruction Overview | Shuoçš„ç©ºé—´ç«™</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Shuoçš„ç©ºé—´ç«™</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Lavender SpacecraftğŸªâœ¨</p>
      <img class="custom-logo-image" src="/source/images/favicon_io/apple-touch-icon.png" alt="Shuoçš„ç©ºé—´ç«™">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">2</span></a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">è¯­æ³•ä»‹ç»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.</span> <span class="nav-text">æ±‡ç¼–æŒ‡ä»¤æ“ä½œå¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">2.1.</span> <span class="nav-text">å¯„å­˜å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98"><span class="nav-number">2.2.</span> <span class="nav-text">å†…å­˜</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">æŒ‡ä»¤ç¼–ç æ ¼å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-R-type-Register"><span class="nav-number">3.1.</span> <span class="nav-text">1. R-type:(Register)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#All-Instructions"><span class="nav-number">3.1.0.1.</span> <span class="nav-text">All Instructions</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-I-type-Immediate"><span class="nav-number">3.2.</span> <span class="nav-text">2. I-type: (Immediate)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#All-instructions"><span class="nav-number">3.2.0.1.</span> <span class="nav-text">All instructions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Load-Instructions-are-also-I-type"><span class="nav-number">3.2.0.2.</span> <span class="nav-text">Load Instructions are also I-type</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-S-type-Store"><span class="nav-number">3.3.</span> <span class="nav-text">3. S-type: (Store)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#All-instructions-1"><span class="nav-number">3.3.0.1.</span> <span class="nav-text">All instructions</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-B-type-Branch"><span class="nav-number">3.4.</span> <span class="nav-text">4. B-type: (Branch)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Branching-Instruction-Usage"><span class="nav-number">3.4.1.</span> <span class="nav-text">Branching Instruction Usage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PC-Relative-Addressing"><span class="nav-number">3.4.2.</span> <span class="nav-text">PC-Relative Addressing</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Branch-Calculation"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">Branch Calculation</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Actural-RV32-Branch-Calculation"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">Actural RV32 Branch Calculation</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Determine-Offset"><span class="nav-number">3.4.2.3.</span> <span class="nav-text">Determine Offset</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#All-instructions-2"><span class="nav-number">3.4.2.4.</span> <span class="nav-text">All instructions</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Translation"><span class="nav-number">3.4.3.</span> <span class="nav-text">Translation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-U-type-Upper"><span class="nav-number">3.4.4.</span> <span class="nav-text">5. U-type: (Upper)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Long-Immediate"><span class="nav-number">3.4.5.</span> <span class="nav-text">Long Immediate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LUI-to-Create-Long-Immediate"><span class="nav-number">3.4.6.</span> <span class="nav-text">LUI to Create Long Immediate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AUIPC"><span class="nav-number">3.4.7.</span> <span class="nav-text">AUIPC</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-J-type-Jump"><span class="nav-number">3.5.</span> <span class="nav-text">6. J-type: (Jump)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Uses-of-JAL"><span class="nav-number">3.5.1.</span> <span class="nav-text">Uses of JAL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JALR-Instruction-I-Format"><span class="nav-number">3.5.2.</span> <span class="nav-text">JALR Instruction (I-Format)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Uses-of-JALR"><span class="nav-number">3.5.2.1.</span> <span class="nav-text">Uses of JALR</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Translation-Between-hexdecimal-and-instructions"><span class="nav-number">3.6.</span> <span class="nav-text">Translation Between hexdecimal and instructions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PC-Addressing"><span class="nav-number">4.</span> <span class="nav-text">PC-Addressing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Questions-on-PC-addressing"><span class="nav-number">4.1.</span> <span class="nav-text">Questions on PC-addressing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RISC-V-%E6%8C%87%E4%BB%A4%E5%AF%BB%E5%9D%80%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93"><span class="nav-number">4.2.</span> <span class="nav-text">RISC-V æŒ‡ä»¤å¯»å€æ¨¡å¼æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4-Arithmetic-Instruction"><span class="nav-number">5.</span> <span class="nav-text">ç®—æœ¯è¿ç®—æŒ‡ä»¤ Arithmetic Instruction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#addi"><span class="nav-number">5.1.</span> <span class="nav-text">addi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LUI-Load-Upper-Immediate"><span class="nav-number">5.2.</span> <span class="nav-text">LUI (Load Upper Immediate)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AUIPC-add-upper-immediate-to-pc"><span class="nav-number">5.3.</span> <span class="nav-text">AUIPC (add upper immediate to pc)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LA%EF%BC%88Load-Address%EF%BC%89"><span class="nav-number">5.4.</span> <span class="nav-text">LAï¼ˆLoad Addressï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MUL"><span class="nav-number">5.5.</span> <span class="nav-text">MUL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%85%B6%E4%BB%96%E4%BC%AA%E6%8C%87%E4%BB%A4"><span class="nav-number">5.6.</span> <span class="nav-text">åŸºäºç®—æœ¯è¿ç®—æŒ‡ä»¤å®ç°çš„å…¶ä»–ä¼ªæŒ‡ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PC-Relative-amp-PC-Absolute"><span class="nav-number">5.7.</span> <span class="nav-text">PC-Relative &amp; PC-Absolute</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4-Shifting-Instructions"><span class="nav-number">6.</span> <span class="nav-text">ç§»ä½è¿ç®—æŒ‡ä»¤ (Shifting Instructions)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E7%A7%BB%E4%BD%8D"><span class="nav-number">6.1.</span> <span class="nav-text">é€»è¾‘ç§»ä½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SLLI"><span class="nav-number">6.1.1.</span> <span class="nav-text">SLLI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E7%A7%BB%E4%BD%8D"><span class="nav-number">6.2.</span> <span class="nav-text">ç®—æœ¯ç§»ä½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E6%8C%87%E4%BB%A4"><span class="nav-number">7.</span> <span class="nav-text">å†…å­˜è¯»å†™æŒ‡ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E8%AF%BB-Load"><span class="nav-number">7.1.</span> <span class="nav-text">å†…å­˜è¯» (Load)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%86%99-store"><span class="nav-number">7.2.</span> <span class="nav-text">å†…å­˜å†™ (store)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%EF%BC%88Unconditional-Jump-Instructions%EF%BC%89"><span class="nav-number">7.3.</span> <span class="nav-text">æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆUnconditional Jump Instructionsï¼‰</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%94%AF%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="nav-number">8.</span> <span class="nav-text">åˆ†æ”¯è·³è½¬æŒ‡ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF%E6%8C%87%E4%BB%A4%EF%BC%88Conditional-Branch-Instructions%EF%BC%89"><span class="nav-number">8.1.</span> <span class="nav-text">æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ï¼ˆConditional Branch Instructionsï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RISC-V-Features-n-times-16-bit-Instructions"><span class="nav-number">8.2.</span> <span class="nav-text">RISC-V Features, $n\times 16$-bit Instructions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RISC-V-Immediates"><span class="nav-number">9.</span> <span class="nav-text">RISC-V Immediates</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#No-Subtract-Immediate"><span class="nav-number">9.1.</span> <span class="nav-text">No Subtract Immediate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Register-Zero"><span class="nav-number">9.2.</span> <span class="nav-text">Register Zero</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Addresses-are-in-Bytes"><span class="nav-number">10.</span> <span class="nav-text">Memory Addresses are in Bytes</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        
      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/shuoO-24" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, cn">
    <link itemprop="mainEntityOfPage" href="http://shuoo-24.github.io/2021/06/30/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ibb.co/d6rcNrG">
      <meta itemprop="name" content="Shuo">
      <meta itemprop="description" content="ä¸–ç•ŒçŒ®æˆ‘ä»¥æ­Œ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shuoçš„ç©ºé—´ç«™">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RISC-V Instruction Overview
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-30 03:23:04" itemprop="dateCreated datePublished" datetime="2021-06-30T03:23:04-07:00">2021-06-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-17 13:41:23" itemprop="dateModified" datetime="2021-07-17T13:41:23-07:00">2021-07-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/UCB-61C/" itemprop="url" rel="index"><span itemprop="name">UCB-61C</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p><em>References:</em></p>
<ol>
<li><em>ã€å‚è€ƒ 1ã€‘: The RISC-V Instruction Set Manual, Volume I: Unprivileged ISA, Document Version 20191213</em></li>
<li><em>ã€å‚è€ƒ 2ã€‘: Using as: <a target="_blank" rel="noopener" href="https://sourceware.org/binutils/docs/as/">https://sourceware.org/binutils/docs/as/</a></em></li>
<li><em>ã€å‚è€ƒ 3ã€‘: How to Use Inline Assembly Language in C Code: <a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Using-">https://gcc.gnu.org/onlinedocs/gcc/Using-</a> Assembly-Language-with-C.html</em></li>
</ol>
</blockquote>
<p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5he6eo1mj30xc0i8tku.jpg" alt="image-20210704113134394"></em></p>
<h2 id="è¯­æ³•ä»‹ç»"><a href="#è¯­æ³•ä»‹ç»" class="headerlink" title="è¯­æ³•ä»‹ç»"></a>è¯­æ³•ä»‹ç»</h2><ul>
<li><p>An instruction consists of </p>
<ul>
<li><u>==opcode==</u>: unique code to specify the desired operation</li>
<li>==<u>operands</u>==: zero or more additionalinformation needed for the operation</li>
</ul>
</li>
<li><p>The operation designates the type and size of the operands</p>
<ul>
<li><p>Typical type and size: </p>
<ul>
<li>Character (8 bits), </li>
<li>half-word (eg:16bits), </li>
<li>word (eg:32bits) </li>
<li>single-precision floating point (eg:1word), </li>
<li>double-precision floating point (eg:2 words).</li>
</ul>
</li>
<li><p>Expectations from any new 32-bit architecture:</p>
<p>Support for8-, 16-and 32-bit integer and 32-bitand 64-bit floating point operations. A 64-bit architecture would need to support 64-bit integers as well.</p>
</li>
</ul>
</li>
<li><p>ä¸€ä¸ªå®Œæ•´çš„ RISC-V æ±‡ç¼–ç¨‹åºæœ‰å¤šæ¡ è¯­å¥ (statement) ç»„æˆã€‚</p>
</li>
<li><p>ä¸€æ¡å…¸å‹çš„ RISC-V æ±‡ç¼– è¯­å¥ ç”± 3 éƒ¨åˆ†ç»„æˆ:</p>
<p><code>[label:] [operation][comment]</code></p>
<ul>
<li><p><code>label</code> GNUæ±‡ç¼–ä¸­ï¼Œä»»ä½•ä»¥å†’å·ç»“å°¾çš„æ ‡è¯†ç¬¦éƒ½è¢« è®¤ä¸ºæ˜¯ä¸€ä¸ªæ ‡å·ã€‚</p>
</li>
<li><p><code>operation</code> å¯ä»¥æœ‰ä»¥ä¸‹å¤šç§ç±»å‹:</p>
<ul>
<li>==instruction==(æŒ‡ä»¤): ç›´æ¥å¯¹åº”äºŒè¿›åˆ¶æœºå™¨æŒ‡ä»¤çš„å­—ç¬¦ä¸²</li>
<li>==pseudo-instruction==(ä¼ªæŒ‡ä»¤): ä¸ºäº†æé«˜ç¼–å†™ä»£ç çš„æ•ˆç‡ï¼Œå¯ä»¥ç”¨ä¸€æ¡ä¼ªæŒ‡ä»¤æŒ‡ç¤ºæ±‡ç¼–å™¨äº§ç”Ÿå¤šæ¡å®é™…çš„æŒ‡ä»¤(instructions)ã€‚</li>
<li>==directive==(æŒ‡ç¤º/ä¼ªæ“ä½œ): é€šè¿‡ç±»ä¼¼æŒ‡ä»¤çš„å½¢å¼(ä»¥â€œ.â€å¼€å¤´)ï¼Œé€šçŸ¥æ±‡ç¼–å™¨å¦‚ä½•æ§åˆ¶ä»£ç çš„äº§ç”Ÿç­‰ï¼Œä¸å¯¹åº”å…·ä½“çš„æŒ‡ä»¤ã€‚ </li>
<li>==macro==: é‡‡ç”¨ .macro/.endm è‡ªå®šä¹‰çš„å®</li>
</ul>
</li>
<li><p><code>comment</code>(æ³¨é‡Š): æ³¨é‡Šæ–¹å¼ï¼Œâ€œ#â€ å¼€å§‹åˆ°å½“å‰è¡Œç»“æŸã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 id="æ±‡ç¼–æŒ‡ä»¤æ“ä½œå¯¹è±¡"><a href="#æ±‡ç¼–æŒ‡ä»¤æ“ä½œå¯¹è±¡" class="headerlink" title="æ±‡ç¼–æŒ‡ä»¤æ“ä½œå¯¹è±¡"></a>æ±‡ç¼–æŒ‡ä»¤æ“ä½œå¯¹è±¡</h2><h3 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h3><ul>
<li><p><em>32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œx0 ~ x31(æ³¨æ„: ä»…æ¶‰åŠ RV32I çš„é€šç”¨å¯„å­˜å™¨ç»„);</em></p>
</li>
<li><p><em>åœ¨ RISC-V ä¸­ï¼ŒHart åœ¨æ‰§è¡Œç®—æœ¯é€»è¾‘è¿ç®—æ—¶æ‰€æ“ä½œçš„ æ•°æ®å¿…é¡»ç›´æ¥æ¥è‡ªå¯„å­˜å™¨ã€‚</em></p>
</li>
</ul>
<h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a><em>å†…å­˜</em></h3><ul>
<li><em>Hart å¯ä»¥æ‰§è¡Œåœ¨å¯„å­˜å™¨å’Œå†…å­˜ä¹‹é—´çš„æ•°æ®è¯»å†™æ“ä½œ;</em></li>
<li><em>è¯»å†™æ“ä½œä½¿ç”¨å­—èŠ‚(Byte)ä¸ºåŸºæœ¬å•ä½è¿›è¡Œå¯»å€; â€¢ RV32 å¯ä»¥è®¿é—®æœ€å¤š $2^32$ ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ã€‚</em></li>
</ul>
<hr>
<h2 id="æŒ‡ä»¤ç¼–ç æ ¼å¼"><a href="#æŒ‡ä»¤ç¼–ç æ ¼å¼" class="headerlink" title="æŒ‡ä»¤ç¼–ç æ ¼å¼"></a>æŒ‡ä»¤ç¼–ç æ ¼å¼</h2><p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5fcais71j30wq0h4gys.jpg" alt="image-20210704102033367"></em></p>
<ul>
<li><p><em>`</em>func7`æŒ‡æœ‰7ä¸ªbytes**</p>
<ul>
<li><code>func3</code> å’Œ <code>func7</code> æ€»æ˜¯ $000$ å’Œ $0000000$</li>
</ul>
</li>
<li><p>One <u>word</u> is 32 bits, so divide instruction word into â€œ==fields==â€</p>
<ul>
<li>Each field tells processor something about instruction</li>
</ul>
</li>
<li><p>We could define different fields for each instruction, but RISC-V seeks simplicity, so define six basic types of instruction formats:</p>
<ol>
<li><p><em>==R-format for register-register arithmetic operations==</em></p>
</li>
<li><p><em>==I-format for register-immediate arithmetic operations and loads==</em></p>
</li>
<li><p><em>==S-format for stores==</em></p>
</li>
<li><p><em>==B-format for branches (minor variant of S-format)==</em></p>
</li>
<li><p><em>==U-format for 20-bit upper immediate instructions==</em></p>
</li>
<li><p><em>==J-format for jumps (minor variant of U-format)==</em></p>
</li>
</ol>
</li>
</ul>
<h3 id="1-R-type-Register"><a href="#1-R-type-Register" class="headerlink" title="1. R-type:(Register)"></a>1. R-type:(Register)</h3><ul>
<li>æ¯æ¡æŒ‡ä»¤ä¸­æœ‰<strong>ä¸‰ä¸ª fields</strong>ï¼Œç”¨äºæŒ‡å®š <strong>3 ä¸ªå¯„å­˜å™¨</strong>å‚æ•° â€” æ•°é‡å°‘ï¼Œæ“ä½œå¿«</li>
<li><p><code>opcode</code>: partially specifies what instruction it is</p>
<ul>
<li>This field is equal to $0110011_{\text{two}}$ for all R-format register-register arithmetic instructioins</li>
</ul>
</li>
<li><p><strong>fields</strong>:</p>
<ul>
<li><code>rs1</code>: source register field #1</li>
<li><code>rs2</code>: source register field #2</li>
<li><code>rd</code>: <u>destination register</u> which will receive <strong>result</strong> of the computation</li>
<li><strong>Each register holds a 5-bit unsigned integer(0-31) to corresponding to a register number (x0-x31)</strong></li>
</ul>
</li>
<li><p>Six fields: </p>
<p>7(<code>func7</code>) + 5(<code>rs2</code>) + 5(<code>rs1</code>) + 3(<code>func3</code>) + 5(<code>rd</code>) + 7(<code>opcode</code>) = 32</p>
<ul>
<li>Why <code>rs1</code>, <code>rs2</code>, and <code>rd</code> have 5 bits?<ul>
<li>To store exactly 32 values from 0 to 21 ($2^5=32$).</li>
</ul>
</li>
</ul>
</li>
<li><p><em><img src="https://tva1.sinaimg.cn/large/008i3skNly1gs5fnyma1ij310o0kajx2.jpg" alt="image-20210704103146634" style="zoom:47%;" /></em></p>
</li>
<li><p>We can <strong>change value of <code>func3</code> and <code>func7</code></strong> to perform different instructions, and in total we can perform $(2^3\cdot2^7)=2^{10}=1024$ R-format instructions.</p>
<ul>
<li><code>func3</code> and <code>func7</code>describe what operation to perform</li>
</ul>
</li>
</ul>
<h5 id="All-Instructions"><a href="#All-Instructions" class="headerlink" title="All Instructions"></a>All Instructions</h5><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7qudka3vj30jy0huq6b.jpg" alt="image-20210706102937190"></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7qulweclj30ji068jsm.jpg" alt="image-20210706102953167"></p>
<h3 id="2-I-type-Immediate"><a href="#2-I-type-Immediate" class="headerlink" title="2. I-type: (Immediate)"></a>2. I-type: (Immediate)</h3><ul>
<li><em>æ¯æ¡æŒ‡ä»¤é™¤äº†å¸¦æœ‰<strong>ä¸¤ä¸ªå¯„å­˜å™¨</strong>å‚æ•°å¤–ï¼Œè¿˜å¸¦æœ‰ä¸€ä¸ª<strong>ç«‹å³æ•°</strong>å‚æ•°ï¼ˆç”¨æ¥è¡¨ç¤ºæ•´æ•°ï¼‰</em></li>
<li>Compare: <strong>add rd,rs1,rs2</strong> with <strong>addi rd, rs1, imm</strong><ul>
<li>5-bit field only represents numbers up to the value 31:</li>
<li>immediates may be much larger than this</li>
</ul>
</li>
<li>Ideally, RISC-V would have only one instruction format (for simplicity): unfortunately, we need to compromise</li>
<li>Define new instruction format that is mostly consistent with R-format</li>
<li>Notice if instruction has immediate, then uses <strong>at most 2 registers</strong> (one source, one destination)<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5gduzha0j31220l6djh.jpg" alt="image-20210704105640491" style="zoom: 33%;" /></li>
<li><code>immediate</code>: <ul>
<li><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5gej2nfej310e0hajut.jpg" alt="image-20210704105718907" style="zoom: 33%;" />*</li>
</ul>
</li>
<li>When the I-type format is used for load instructions, the <strong>immediate represents a byte offset</strong>, so the load doubleword instruction can refer to any doubleword within a region of $Â±\;2^{11}$ or 2048 bytes ($Â±\;2^8$ or 256 doublewords) of the base address in the base register <code>rd</code></li>
</ul>
<h5 id="All-instructions"><a href="#All-instructions" class="headerlink" title="All instructions"></a>All instructions</h5><p><em><img src="https://tva1.sinaimg.cn/large/008i3skNly1gs5gg1g2o8j60zi0fsqdf02.jpg" alt="image-20210704105845398"></em></p>
<ul>
<li><em><code>srai</code>:  <u>shift right arithmetic (srai</u>). This variant is similar to srli, except rather than filling the vacated bits on the left with zeros, it <em>*fills them with copies of the old sign bit.</em></em> </li>
</ul>
<h5 id="Load-Instructions-are-also-I-type"><a href="#Load-Instructions-are-also-I-type" class="headerlink" title="Load Instructions are also I-type"></a>Load Instructions are also I-type</h5><p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5gr6txumj31040joqcz.jpg" alt="image-20210704110929274"></em></p>
<ul>
<li><code>opcode</code>: <strong>0000011</strong></li>
</ul>
<p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5h1c25qbj30xa06mjs7.jpg" alt="image-20210704111914066" style="zoom:50%;" /></em></p>
<ul>
<li>The 12-bit signed immediate is added to the base address in register <code>rsl</code> to form the memory address<ul>
<li>This is very similar to the add-immediate operation but used to create address, not to create final result</li>
</ul>
</li>
<li>Value loaded from memory is stored in <code>rd</code></li>
</ul>
<h3 id="3-S-type-Store"><a href="#3-S-type-Store" class="headerlink" title="3. S-type: (Store)"></a>3. S-type: (Store)</h3><ul>
<li>æ¯æ¡æŒ‡ä»¤é™¤äº†å¸¦æœ‰<strong>ä¸¤ä¸ªå¯„å­˜å™¨</strong>å‚æ•°å¤–ï¼ˆæ— <code>sd</code>ï¼‰ï¼Œè¿˜å¸¦æœ‰ä¸€ä¸ª<strong>ç«‹å³æ•°</strong>å‚æ•°(å®½åº¦ä¸º 12 bitsï¼Œä½† fields çš„ç»„ç»‡æ–¹å¼ä¸åŒäº I-typeï¼Œåˆ†ä¸ºä¸¤ä¸ªfieldæ¥å­˜å‚¨ä¸€ä¸ªimmediate)</li>
<li><p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5h34mr9lj30wq03emxl.jpg" alt="image-20210704112057665"></em></p>
</li>
<li><p>Store needs to read two registers</p>
<ul>
<li><code>rs1</code> for base memory address</li>
<li><code>rs2</code> for data to be stored</li>
<li><code>immediate</code> <code>offset</code></li>
</ul>
</li>
<li>Canâ€™t have both <code>rs2</code> and <code>immediate</code> in same place as other instructions! </li>
<li><strong>Note</strong>: stores donâ€™t write a value to the register file, no <code>rd</code>!</li>
<li>RISC-V design decision is move low 5 bits of <code>immediate</code> to where <code>rd</code> field was in other instructions â€“ keep <code>rs1</code>/<code>rs2</code> fields in same place </li>
<li>register names more critical than immediate bits in hardware design</li>
<li><strong>Example</strong>: <img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5h5fkiuwj30wg09iwh4.jpg" alt="image-20210704112310134" style="zoom:33%;" /></li>
</ul>
<h5 id="All-instructions-1"><a href="#All-instructions-1" class="headerlink" title="All instructions"></a>All instructions</h5><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jf9er3uj31000gkgrh.jpg" alt="image-20210706061256759"></p>
<h3 id="4-B-type-Branch"><a href="#4-B-type-Branch" class="headerlink" title="4. B-type: (Branch)"></a>4. B-type: (Branch)</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7j9rfyv1j30zk07qdgz.jpg" alt="image-20210706060738252"></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7k2cigqrj319e06i0ya.jpg" alt="image-20210706063508120"></p>
<ul>
<li><p>æ¯æ¡æŒ‡ä»¤é™¤äº†å¸¦æœ‰<strong>ä¸¤ä¸ªå¯„å­˜å™¨</strong>å‚æ•°å¤–ï¼ˆæ— <code>sd</code>ï¼‰ï¼Œè¿˜å¸¦æœ‰ä¸€ä¸ª<strong>ç«‹å³æ•°</strong>å‚æ•°(å®½åº¦ ä¸º 12 bitsï¼Œä½†å–å€¼ä¸º 2 çš„å€æ•°)ã€‚</p>
</li>
<li><p>ä¸åˆ†æ”¯è·³è½¬æœ‰å…³</p>
</li>
<li><p>B-format is mostly same as S-Format, with two register sources (<strong>rs1</strong>/<strong>rs2</strong>) and a 12-bit immediate <strong>imm[12:1]</strong></p>
<ul>
<li><p>But now <code>immediate</code> represents values -4096 to +4094 in 2-byte increments</p>
</li>
<li><p>The 12 <code>immediate</code> bits encode even 13-bit signed byte offsets (<strong>lowest</strong> <strong>bit of offset is always zero</strong>, so no need to store it)</p>
</li>
<li><code>Immediate</code> is translated as the <strong>offset</strong> of the <code>label</code> passed in from the PC, i.e. <code>labelâˆ’PC=imm</code>. It is then broken down bitwise and encoded into the bitstring in the format given. All other fields remain the same as previous instruction formats.</li>
</ul>
</li>
</ul>
<h4 id="Branching-Instruction-Usage"><a href="#Branching-Instruction-Usage" class="headerlink" title="Branching Instruction Usage"></a>Branching Instruction Usage</h4><ul>
<li>Typically used for <strong>loops</strong><ul>
<li>Loops are generally <strong>small</strong> (&lt; 50 instructions)</li>
<li><strong>Unconditional</strong> jumping and <strong>function</strong> call are <strong>J-format</strong> and handled with jump instructions</li>
</ul>
</li>
<li><strong>Recall</strong>: instructions are stored in a localized area of memory (<strong>Text/Code</strong>)<ul>
<li>Largest branching <strong>distance</strong> is <strong>limited by size of code</strong></li>
<li>Address of current instruction is stored in <u>program counter(PC)</u></li>
</ul>
</li>
</ul>
<h4 id="PC-Relative-Addressing"><a href="#PC-Relative-Addressing" class="headerlink" title="PC-Relative Addressing"></a><u>PC-Relative Addressing</u></h4><ul>
<li>Use immediateâ€™s field as a <strong>twoâ€™s-complement offset</strong> to PC<ul>
<li>Uses the <strong>PC and adds the immediate value of the instruction (multiplied by 2)</strong> to create an address (used by branch and jump instructions)</li>
</ul>
</li>
<li>Branches generally change the PC by a small amount</li>
<li>Can specify $\pm\;2^{11}$ â€˜unitâ€™ addresses from the PC<ul>
<li>5 units from the destination register we donâ€™t need</li>
<li>7 units from <code>func7</code> field</li>
<li>We will see in a bit that we can <strong>encode 12-bit offsets</strong> as <code>immediate</code></li>
<li><em>In RISC V, many instructions have a 12-bit offset, and these are all signed extended to 32- or 64-bits (for RV32 or RV64, respectively). (Some instructions have a 20-bit offset, some of which work a bit differently.)</em></li>
<li><strong>Explaination to the question</strong>: <em>What is range of 32-bit instructions that can be reached from the current PC using a branch instruction?</em><ul>
<li>The immediate field of the branch instruction is <strong>12 bits</strong>. This field only references addresses that are <strong>divisible by 2</strong>, so the immediate is <strong>multiplied by 2</strong> before being added to the PC. Thus, the branch immediate can move the reference 2-byte instructions that are within $[âˆ’2^{11} , 2^{11} âˆ’ 1]$ instructions of the current PC.</li>
<li>The instructions we use, however, are 4 bytes so they reside at addresses that are divisible by 4 not 2. Therefore, we can only reference half as many 4-byte instructions as before, and the range of 4-byte instructions is $[âˆ’2^{10} , 2^{10} âˆ’ 1]$</li>
</ul>
</li>
</ul>
</li>
<li>Why <strong>not use byte</strong>s as a unit of offset from PC?<ul>
<li>Because instructions are 32-bit (4-bytes)</li>
<li>We donâ€™t branch into middle of instruction</li>
</ul>
</li>
</ul>
<h5 id="Branch-Calculation"><a href="#Branch-Calculation" class="headerlink" title="Branch Calculation"></a>Branch Calculation</h5><ul>
<li><p>If we donâ€™t take the branch:</p>
<ul>
<li><strong>PC = PC + 4</strong> (i.e., next instruction)</li>
</ul>
</li>
<li><p>If we do take the branch: </p>
<ul>
<li><strong>PC = PC + immediate * 4</strong></li>
</ul>
</li>
<li><p>Observations:</p>
<ul>
<li><strong>immediate</strong> is number of instructions to jump (remember, specifies words) either <strong>forward</strong> (+) or <strong>backwards</strong> (â€“)</li>
</ul>
</li>
</ul>
<h5 id="Actural-RV32-Branch-Calculation"><a href="#Actural-RV32-Branch-Calculation" class="headerlink" title="Actural RV32 Branch Calculation"></a>Actural RV32 Branch Calculation</h5><ul>
<li><p>If we donâ€™t take the branch:</p>
<ul>
<li><strong>PC = PC + 4</strong> (i.e., next instruction)</li>
</ul>
</li>
<li><p>If we do take the branch: </p>
<ul>
<li><strong>PC = PC + immediate * 2</strong></li>
</ul>
</li>
</ul>
<h5 id="Determine-Offset"><a href="#Determine-Offset" class="headerlink" title="Determine Offset"></a>Determine Offset</h5><ul>
<li><p><strong>Example</strong>: <img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jdpwn7ij30rs0a4dhg.jpg" alt="image-20210706061127996" style="zoom: 33%;" /></p>
<ul>
<li><p>==Branch <strong>offset</strong> = <strong>4</strong>Ã—<strong>32-bit instructions = 16 bytes</strong>==</p>
<p>(Branch with offset of 0, branches to itself)</p>
</li>
<li><p><strong>Encoding</strong>:<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jidrvq4j30yo06u764.jpg" alt="image-20210706061556361"></p>
<ul>
<li>Opocode for <code>BRANCH</code> <code>beq</code>: 1100011</li>
<li><code>rs1</code>: 19 in binary</li>
<li><code>rs2</code>: 10 in binary</li>
</ul>
</li>
<li><p><strong>Complete Encoding</strong>:</p>
<ul>
<li><code>beq x19, x10</code>, <strong>offset</strong> = <strong>16</strong> bytes</li>
<li>13-bit <strong>immediate</strong>, <code>imm[12:0]</code>, with value <strong>16</strong><ul>
<li>$0000000010000$, <code>imm[0]</code>is discarded, always zero</li>
</ul>
</li>
<li><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jtma6ngj31380ay41w.jpg" alt="image-20210706062644563"></li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="All-instructions-2"><a href="#All-instructions-2" class="headerlink" title="All instructions"></a>All instructions</h5><ul>
<li>Opcode is the same of all branches: $1100011$</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7jb34hw9j310i0pm10o.jpg" alt="image-20210706060855809"></p>
<h4 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h4><ul>
<li>Retrieve <code>imm</code> value:<ul>
<li>address of <code>bne</code> - address of label position</li>
<li>sign extend to 13 bits</li>
<li>rearrange bits in appropriate order</li>
</ul>
</li>
</ul>
<h4 id="5-U-type-Upper"><a href="#5-U-type-Upper" class="headerlink" title="5. U-type: (Upper)"></a>5. U-type: (Upper)</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7ka4caqhj30t806g3z6.jpg" alt="image-20210706064235075"></p>
<p>æ¯æ¡æŒ‡ä»¤å«æœ‰ä¸€ä¸ªå¯„å­˜å™¨å‚æ•°å†åŠ ä¸Šä¸€ä¸ªç«‹å³æ•°å‚æ•°(å®½åº¦ä¸º 20 bitsï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ª<strong>ç«‹å³æ•°çš„é«˜ 20 ä½</strong>)</p>
<h4 id="Long-Immediate"><a href="#Long-Immediate" class="headerlink" title="Long Immediate"></a>Long Immediate</h4><ul>
<li><p>We want to load a memory address into a register so we can jump to it laterâ€”how can we do that in one instruction? </p>
<ul>
<li>We canâ€™t! </li>
<li>Because  instructions  in  our  system  are  words,  which  are  32-bits.   Ourregisters can hold that length, being 32-bits themselves. However, because our instructions them-selves are 32-bits, attempting to load something else thatâ€™s 32 bits, well, that just doesnâ€™t work out logically. </li>
<li>Thus, we need at the very least, <strong>2 instructions</strong> to do that.  All the instructions we have currently fill in the <strong>lower bits</strong> of a register; the ones (I-type) weâ€™re interested in takes care of the base 12 bits.  To handle the <strong>upper 20 bits</strong>, we now use our <strong>upper immediate instructions</strong>. </li>
</ul>
</li>
<li><p>Has <strong>20-bit immediate</strong> in upper <strong>20</strong> bits of 32-bit instruction word</p>
</li>
<li><p>One destination register, <code>rd</code></p>
</li>
<li><p>There are two such instructions: </p>
<ul>
<li><strong>lui </strong>â€“ Load Upper Immediate</li>
<li><strong>auipc</strong> â€“ Add Upper Immediate to PC</li>
</ul>
</li>
</ul>
<h4 id="LUI-to-Create-Long-Immediate"><a href="#LUI-to-Create-Long-Immediate" class="headerlink" title="LUI to Create Long Immediate"></a>LUI to Create Long Immediate</h4><ul>
<li><p>LUI writes the upper 20 bits of the destination with the immediate value, and clears the lower 12 bits.</p>
</li>
<li><p>Together with an <strong>addi</strong> to set low 12 bits, can create any 32-bit value in a register using two instructions (<strong>lui</strong>/<strong>addi</strong>).</p>
</li>
<li><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kar8s5kj30s80300tr.jpg" alt="image-20210706064313290" style="zoom:67%;" /></p>
<ul>
<li>LUI puts 0x87654 into the upper 20 bits(5 nibbles) and <code>addi</code> adds 0x321 to it. </li>
</ul>
</li>
<li><p><strong>addi </strong>12-bit immediate is always <strong>sign-extended</strong>, if <strong>top bit is set</strong>, will subtract -1 from upper 20 bits: <img src="https://tva1.sinaimg.cn/large/008i3skNly1gs7kifvy3nj30qy03it96.jpg" alt="image-20210706065036469"></p>
</li>
<li><strong>Pre-increment</strong> value placed in upper 20 bits, if sign bit will be set on immediate in lower 12 bits:<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kiwsgy9j30rq066dgi.jpg" alt="image-20210706065102507" style="zoom:50%;" /></li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kd2qphzj30r20ekgon.jpg" alt="image-20210706064526385" style="zoom:37%;" /></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7kdbv5y0j30r209w0tr.jpg" alt="image-20210706064541923" style="zoom:37%;" /></p>
<ul>
<li><p>Assembler pseudo-op handles all of this:</p>
<p><code>li x10, 0xDEADBEEF # Creates two instructions</code></p>
</li>
</ul>
<h4 id="AUIPC"><a href="#AUIPC" class="headerlink" title="AUIPC"></a>AUIPC</h4><ul>
<li><p>Adds upper immediate value to PC and places result in destination register</p>
</li>
<li><p>Used for PC-relative addressing</p>
</li>
<li><p><code>Label: AUIPC x10, 0 # Puts address of Label in x10</code></p>
</li>
</ul>
<h3 id="6-J-type-Jump"><a href="#6-J-type-Jump" class="headerlink" title="6. J-type: (Jump)"></a>6. J-type: (Jump)</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7lfqfncbj30yi04wdge.jpg" alt="image-20210706072234463"></p>
<p>æ¯æ¡æŒ‡ä»¤å«æœ‰<strong>ä¸€ä¸ªå¯„å­˜å™¨</strong>å‚æ•°å†åŠ ä¸Š<strong>ä¸€ä¸ªç«‹å³æ•°</strong>å‚æ•°(å®½åº¦ä¸º 20 bits)</p>
<ul>
<li><p><strong>jal</strong> saves PC+4 in register <strong>rd</strong> (the return address)</p>
<ul>
<li>Assembler â€œ<strong>j</strong>â€ jump is pseudo-instruction, uses JAL but sets <strong>rd=x0</strong> to discard return address</li>
</ul>
</li>
<li><p>Set PC = PC + offset (PC-relative jump)</p>
</li>
<li><p>Target somewhere within $Â±\;2^{19}$ locations, 2 bytes apart (Even address)</p>
<ul>
<li>$Â±\;2^{18}$ 32-bit instructions</li>
</ul>
</li>
<li>Immediate encoding optimized similarly to branch instruction to reduce hardware cost</li>
</ul>
<h4 id="Uses-of-JAL"><a href="#Uses-of-JAL" class="headerlink" title="Uses of JAL"></a>Uses of JAL</h4><ul>
<li>j pseudo-instruction:<ul>
<li><code>j Label = jal x0, Label # Discard return</code></li>
</ul>
</li>
<li>Call function within $2^{18}$ instructions of PC<ul>
<li><code>jal ra, FuncName</code></li>
</ul>
</li>
</ul>
<h4 id="JALR-Instruction-I-Format"><a href="#JALR-Instruction-I-Format" class="headerlink" title="JALR Instruction (I-Format)"></a>JALR Instruction (I-Format)</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7lyaw09sj30x6058gm7.jpg" alt="image-20210706074026909"></p>
<ul>
<li><strong>jalr rd, rs, immediate</strong><ul>
<li>Writes PC+4 to <code>rd</code> (<strong>return address</strong>)</li>
<li>Sets PC = <strong>rs + immediate</strong>(sign-extended and set LSB to 0)</li>
<li>Uses same immediates as arithmetic and loads<ul>
<li><strong>no</strong> multiplication by 2 bytes</li>
<li>In contrast to branches and <strong>jal</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="Uses-of-JALR"><a href="#Uses-of-JALR" class="headerlink" title="Uses of JALR"></a>Uses of JALR</h5><ul>
<li><p><strong>ret and jr psuedo-instructions</strong></p>
<ul>
<li><code>ret = jr ra = jalr x0, ra, 0</code></li>
<li>jump to address stored in <code>ra</code> â€” used in the end of the function called inside another function </li>
</ul>
</li>
<li><p><strong>Call function at any 32-bit absolute address</strong></p>
<ul>
<li><p><code>lui x1, &lt;hi20bits&gt;</code></p>
<p> <code>jalr ra, x1, &lt;lo12bits&gt;</code></p>
</li>
</ul>
</li>
<li><p><strong>Jump PC-relative with 32-bit offset</strong></p>
<ul>
<li><p><code>auipc x1, &lt;hi20bits&gt;</code></p>
<p><code>jalr x0, x1, &lt;lo12bits&gt;</code></p>
</li>
</ul>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7r27qrlfj30r209imyo.jpg" alt="image-20210706103710470" style="zoom:50%;" /></p>
<hr>
<h3 id="Translation-Between-hexdecimal-and-instructions"><a href="#Translation-Between-hexdecimal-and-instructions" class="headerlink" title="Translation Between hexdecimal and instructions"></a>Translation Between hexdecimal and instructions</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7r0a6qpkj30is0rojxv.jpg" alt="image-20210706103520577"></p>
<hr>
<h2 id="PC-Addressing"><a href="#PC-Addressing" class="headerlink" title="PC-Addressing"></a>PC-Addressing</h2><h3 id="Questions-on-PC-addressing"><a href="#Questions-on-PC-addressing" class="headerlink" title="Questions on PC-addressing"></a>Questions on PC-addressing</h3><ul>
<li><p><em>Does the value in branch immediate field change if we <strong>move</strong> the code?</em> </p>
<ul>
<li><p>If <strong>moving individual lines</strong> of code, then yes</p>
</li>
<li><p>If moving <strong>all</strong> of code, then no (<u>â€˜position-independent codeâ€™</u>)</p>
</li>
</ul>
</li>
<li><p><em>What do we do if destination is $&gt;2^{10}$ instructions away from branch?</em> å¦‚ä½•è§£å†³æ›´è¿œè·ç¦»çš„è·³è½¬ï¼Ÿ</p>
<ul>
<li><p>Other instructions save us:</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7k122fq5j30nq03sab2.jpg" alt="image-20210706063353468" style="zoom:33%;" /></p>
</li>
<li><p>The jump will have a much longer reach than branches</p>
</li>
<li></li>
</ul>
</li>
</ul>
<h3 id="RISC-V-æŒ‡ä»¤å¯»å€æ¨¡å¼æ€»ç»“"><a href="#RISC-V-æŒ‡ä»¤å¯»å€æ¨¡å¼æ€»ç»“" class="headerlink" title="RISC-V æŒ‡ä»¤å¯»å€æ¨¡å¼æ€»ç»“"></a>RISC-V æŒ‡ä»¤å¯»å€æ¨¡å¼æ€»ç»“</h3><ul>
<li>å¯»å€æ¨¡å¼æŒ‡çš„æ˜¯æŒ‡ä»¤ä¸­å®šä½<strong>æ“ä½œæ•°(operand)</strong>æˆ–è€…<strong>åœ°å€</strong>çš„æ–¹å¼</li>
</ul>
<p><em><img src="https://tva1.sinaimg.cn/large/008i3skNly1gs5f2f5ei6j314c0io7dz.jpg" alt="image-20210704101104930"></em></p>
<hr>
<h2 id="ç®—æœ¯è¿ç®—æŒ‡ä»¤-Arithmetic-Instruction"><a href="#ç®—æœ¯è¿ç®—æŒ‡ä»¤-Arithmetic-Instruction" class="headerlink" title="ç®—æœ¯è¿ç®—æŒ‡ä»¤ Arithmetic Instruction"></a>ç®—æœ¯è¿ç®—æŒ‡ä»¤ Arithmetic Instruction</h2><div class="table-container">
<table>
<thead>
<tr>
<th>æŒ‡ä»¤</th>
<th><em>è¯­æ³•</em></th>
<th><em>æè¿°</em></th>
<th><em>ä¾‹å­</em></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ADD</code></td>
<td>ADD RD, RS1, RS2</td>
<td>RS1 å’Œ RS2 çš„å€¼ç›¸åŠ ï¼Œç»“æœä¿å­˜åˆ° RD</td>
<td>add x5, x6, x7</td>
<td></td>
</tr>
<tr>
<td><code>SUB</code></td>
<td>SUB RD, RS1, RS2</td>
<td>RS1 çš„å€¼å‡å» RS2 çš„å€¼ï¼Œç»“æœä¿å­˜åˆ° RD</td>
<td>sub x5, x6, x7</td>
<td></td>
</tr>
<tr>
<td><code>ADDI</code></td>
<td>ADDI RD, RS1, IMM</td>
<td>RS1 çš„å€¼å’Œ IMM ç›¸åŠ ï¼Œç»“æœä¿å­˜åˆ° RD</td>
<td>addi x5, x6, 100</td>
<td></td>
</tr>
<tr>
<td><code>LUI</code></td>
<td>LUI RD, IMM</td>
<td>æ„é€ ä¸€ä¸ª 32 ä½çš„æ•°ï¼Œé«˜ 20 ä½å­˜æ”¾ IMMï¼Œä½ 12 ä½æ¸… é›¶ã€‚ç»“æœä¿å­˜åˆ° RD</td>
<td>lui x5, 0x12345</td>
<td></td>
</tr>
<tr>
<td><code>AUIPC</code></td>
<td>AUIPC RD, IMM</td>
<td>æ„é€ ä¸€ä¸ª 32 ä½çš„æ•°ï¼Œé«˜ 20 ä½å­˜æ”¾ IMMï¼Œä½ 12 ä½æ¸… é›¶ã€‚ç»“æœå’Œ PC ç›¸åŠ åä¿å­˜åˆ° RD</td>
<td><code>auipc x5, 0x12345</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>ä¼ªæŒ‡ä»¤</th>
<th>è¯­æ³•</th>
<th>ç­‰ä»·æŒ‡ä»¤</th>
<th>æè¿°</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LI</code></td>
<td>LI RD, IMM</td>
<td>LUI å’Œ ADDI çš„ç»„åˆ</td>
<td>å°†ç«‹å³æ•° IMM åŠ è½½åˆ° RD ä¸­</td>
<td>li x5, 0x12345678</td>
</tr>
<tr>
<td><em><code>LA</code></em></td>
<td><em><code>LA RD, LABEL</code></em></td>
<td>AUIPC å’Œ ADDIçš„ç»„åˆ</td>
<td>ä¸º <code>RD</code> åŠ è½½ä¸€ä¸ªåœ°å€å€¼</td>
<td>la x5 label</td>
</tr>
<tr>
<td><code>NEG</code></td>
<td>NEG RD, RS</td>
<td>SUB RD, x0, RS</td>
<td>å¯¹ RS ä¸­çš„å€¼å–åå¹¶å°†ç»“æœ å­˜æ”¾åœ¨ RD ä¸­</td>
<td>neg x5, x6</td>
</tr>
<tr>
<td><code>MV</code></td>
<td><code>MV RD, RS</code></td>
<td><code>ADDI RD, RS, 0</code></td>
<td>å°† RS ä¸­çš„å€¼æ‹·è´åˆ° RD ä¸­</td>
<td>mv x5, x6</td>
</tr>
<tr>
<td>NOP</td>
<td>NOP</td>
<td>ADDI x0, x0, 0</td>
<td>ä»€ä¹ˆä¹Ÿä¸åš</td>
<td>nop</td>
</tr>
</tbody>
</table>
</div>
<h3 id="addi"><a href="#addi" class="headerlink" title="addi"></a>addi</h3><div class="table-container">
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>ADDI RD, RS1, IMM</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¾‹å­</td>
<td>add x5, x6, 1</td>
<td>x5 = x6 + 1</td>
</tr>
</tbody>
</table>
</div>
<p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs5hhxrn4sj30uw0cwn3r.jpg" alt="image-20210704113511874" style="zoom:50%;" /></em></p>
<h3 id="LUI-Load-Upper-Immediate"><a href="#LUI-Load-Upper-Immediate" class="headerlink" title="LUI (Load Upper Immediate)"></a>LUI (Load Upper Immediate)</h3><div class="table-container">
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>LUI RD, IMM</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¾‹å­</td>
<td>lui x5, 0x12345</td>
<td>x5 = 0x12345 &lt;&lt; 12</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>LUI</code> æŒ‡ä»¤é‡‡ç”¨ U-typeï¼š <ul>
<li><code>opcode</code> (7): <strong>0b0110111</strong> (LUI)</li>
<li><code>rd</code> (5): â€œdestination registerâ€ ç”¨äºå­˜æ”¾ç»“æœ </li>
<li><code>imm</code> (20): â€œimmediateâ€, ç«‹å³æ•°</li>
</ul>
</li>
<li><code>LUI</code> æŒ‡ä»¤ä¼š<strong>æ„é€ ä¸€ä¸ª 32 bits çš„ç«‹å³æ•°</strong>ï¼Œè¿™ä¸ªç«‹å³æ•°çš„é«˜ 20 ä½å¯¹åº”æŒ‡ä»¤ä¸­çš„ <code>imm</code>ï¼Œä½ 12 ä½æ¸…é›¶ã€‚ è¿™ä¸ªç«‹å³æ•°ä½œä¸ºç»“æœå­˜æ”¾åœ¨ <code>RD</code> ä¸­ã€‚</li>
<li>Can be the first sub-instruction used in <code>la</code></li>
<li>Upper 20 bits set to instruction-type immediate</li>
<li>Stands for â€œLoad Upper Immediateâ€</li>
<li>Lower 12 bits always set to 0</li>
<li><em><code>lui</code> is an U-type instruction (upper immediate); it like all other instructions with a destination register <code>rd</code> will set all 32-bits of the register. However, it is unique in the fact that itâ€™ll set the upper bits to something <strong>other</strong> than 0. This is because it takes the 20-bit immediate and puts it in the upper 20 bits (and the remaining lower 12 bits are set to 0). This is often u<strong>seful when you want to load a 32-bit value (without considering sign/0-extended bits)</strong> into register. Itâ€™s impossible to do with the RISC-V 32-bit architecture as if we need 32 bits for the immediate to load into a register, there is no other available bits to identify <code>rd</code> or instruction type. These two fields fill up the remaining 12 bits (7 bits for opcode, 5 bits for <code>rd</code>).</em></li>
<li><em><code>lui</code> is also considered a <strong><u>0-relative, or absolute, addressing instruction</u></strong>. This means that the U-type immediate it uses is added to 0 instead of the PC (program counter) and thus will address things starting from the â€œstartâ€ of memory as opposed to being an offset to where the current instruction is in memory.</em></li>
<li><em>One of the common ways you might see this instruction used is as the first instruction composing the pseudo-instruction <code>la</code> (load address) along with <code>addi</code> being the second instruction. This is because <code>la</code> takes in a label, and attempts to load the 32-bit address associated with that label; however because we know we <strong>canâ€™t load 32 bits</strong> at a time, we have to break that up so <code>lui</code> takes the upper 20 bits of the address and puts it in <code>rd</code> and the <strong>subsequent <code>addi</code> instruction adds the lower 12 bits to make the 32-bit address</strong>. This is a common way to load other addresses and large immediates as well.</em></li>
<li><strong>Example</strong>:<ul>
<li>åˆ©ç”¨ LUI + ADDI æ¥ä¸ºå¯„å­˜å™¨åŠ è½½ä¸€ä¸ªå¤§æ•° 0x12345678 <ul>
<li><code>lui x1, 0x12345 # x1 = 0x12345000</code> </li>
<li><code>addi x1, x1, 0x678 # x1 = 0x12345678</code></li>
</ul>
</li>
<li>åˆ©ç”¨ LUI + ADDI æ¥ä¸ºå¯„å­˜å™¨åŠ è½½ä¸€ä¸ªå¤§æ•° 0x12345FFF <ul>
<li><code>lui x1, 0x12346 # x1 = 0x12346000</code></li>
<li><code>addi x1, x1, -1 # x1 = 0x12345FFF</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="AUIPC-add-upper-immediate-to-pc"><a href="#AUIPC-add-upper-immediate-to-pc" class="headerlink" title="AUIPC (add upper immediate to pc)"></a>AUIPC (add upper immediate to pc)</h3><div class="table-container">
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>AUIPC RD, IMM</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¾‹å­</td>
<td>auipc x5, 0x12345</td>
<td>x5 = 0x12345 &lt;&lt; 12 + PC</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>AUIPC</code> æŒ‡ä»¤é‡‡ç”¨ U-type</p>
</li>
<li><p>å’Œ <code>LUI</code> æŒ‡ä»¤ç±»ä¼¼ï¼Œ<code>AUIPC</code> æŒ‡ä»¤ä¹Ÿä¼šæ„é€ ä¸€ä¸ª 32 bits çš„ç«‹å³æ•°ï¼Œè¿™ä¸ªç«‹å³æ•°çš„é«˜ 20 ä½å¯¹åº”æŒ‡ä»¤ä¸­ çš„ <code>imm</code>ï¼Œä½ 12 ä½æ¸…é›¶ã€‚ä½†å’Œ <code>LUI</code> ä¸åŒçš„æ˜¯ï¼Œ<code>AUIPC</code> ä¼šå…ˆå°†è¿™ä¸ªç«‹å³æ•°å’Œ PC å€¼ç›¸åŠ ï¼Œå°†ç›¸åŠ åçš„ç»“æœå­˜æ”¾åœ¨ <code>RD</code> ä¸­ã€‚</p>
</li>
<li><p><code>auipc</code> stands for â€œAdd Upper Immediate to Program Counterâ€; the presence of â€œprogram counterâ€ indicates that this is a <u><strong>PC-relative instruction</strong></u>, unlike <code>lui</code>. This means that the U-type immediate it uses is added to the <code>PC</code> at that instruction. However, the nuance behind how the immediate is added is that the immediate added to the PC is shifted to the upper 20 bits and the lower 12 bits are zeroed out again. This does not mean that the immediate itself is 32 bits and gets added to <code>PC</code> and <strong>then</strong> the lower 12 bits get zeroed out as the immediate, as with <code>lui</code>, cannot be a full 32 bits due to bit-restrictions.</p>
</li>
<li><p>There are two common ways you might see <code>auipc</code> used. </p>
<ul>
<li><p>The first is similarly to <code>lui</code>, it loads the label in the <code>la</code> pseudo-instruction; the difference between using <code>auipc</code> and <code>lui</code> that one address will be taken as a PC-relative address whilst the latter will be taken as an absolute address (you can also determine this at compile-time with various flags). <strong>NOTE: in 61C (and overall), <code>lui</code> is used when decomposing <code>la</code>; however itâ€™s becoming more and more common to use <code>auipc</code> commonly.</strong></p>
</li>
<li><p>The second common usage is returning to a specific memory address, e.g. using it in conjunction with <code>jalr</code> in order to <strong>return from a function</strong>. The way in which this works is such that <code>auipc</code> will load a PC-relative address into a register, and then <code>jalr</code> can address to an <code>imm</code> number of bytes offset from that address in order to unconditionally jump to a memory location.</p>
</li>
</ul>
</li>
</ul>
<h3 id="LAï¼ˆLoad-Addressï¼‰"><a href="#LAï¼ˆLoad-Addressï¼‰" class="headerlink" title="LAï¼ˆLoad Addressï¼‰"></a>LAï¼ˆLoad Addressï¼‰</h3><div class="table-container">
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>LA RD, LABEL</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¾‹å­</td>
<td>la x5, foo</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>LAæ˜¯ä¸€ä¸ªä¼ªæŒ‡ä»¤ï¼ˆpseudo-instructionï¼‰</li>
<li>å…·ä½“ç¼–ç¨‹æ—¶ç»™å‡ºéœ€è¦åŠ è½½çš„ <code>label</code>ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®å®é™…æƒ…å†µåˆ©ç”¨ <code>auipc</code> å’Œå…¶ä»–æŒ‡ä»¤è‡ªåŠ¨ç”Ÿæˆæ­£ç¡®çš„æŒ‡ä»¤åºåˆ—ã€‚</li>
<li>å¸¸ç”¨äº<strong>åŠ è½½ä¸€ä¸ªå‡½æ•°æˆ–è€…å˜é‡çš„åœ°å€</strong>ã€‚</li>
</ul>
<h3 id="MUL"><a href="#MUL" class="headerlink" title="MUL"></a>MUL</h3><ul>
<li>ç§¯ = è¢«ä¹˜æ•° Ã— ä¹˜æ•°<ul>
<li>å®ƒæ¯”é™¤æ³•è¦æ›´ä¸ºå¤æ‚ï¼Œæ˜¯å› ä¸ºç§¯çš„é•¿åº¦æ˜¯ä¹˜æ•°å’Œè¢«ä¹˜æ•°é•¿åº¦çš„å’Œã€‚å°†ä¸¤ä¸ª 32 ä½æ•°ç›¸ä¹˜å¾—åˆ°çš„æ˜¯ 64 ä½çš„ä¹˜ç§¯ã€‚ä¸ºäº†æ­£ç¡®åœ°å¾—åˆ°ä¸€ä¸ªæœ‰ç¬¦å·æˆ–æ— ç¬¦å·çš„ 64 ä½ç§¯ï¼ŒRISC-V ä¸­å¸¦æœ‰å››ä¸ªä¹˜æ³•æŒ‡ä»¤ã€‚è¦å¾—åˆ°æ•´æ•° 32 ä½ä¹˜ç§¯ï¼ˆ64 ä½ä¸­çš„<strong>ä½ 32 ä½</strong>ï¼‰å°±ç”¨ <code>mul</code> æŒ‡ä»¤ã€‚è¦å¾—åˆ°<strong>é«˜ 32 ä½</strong>ï¼Œå¦‚æœæ“ä½œæ•°éƒ½æ˜¯æœ‰ç¬¦å·æ•°ï¼Œå°±ç”¨ <code>mulh</code> æŒ‡ä»¤ï¼›å¦‚æœæ“ä½œæ•°éƒ½æ˜¯æ— ç¬¦å·æ•°ï¼Œå°±ç”¨ mulhu æŒ‡ä»¤ï¼›å¦‚æœä¸€ä¸ªæœ‰ç¬¦å·ä¸€ä¸ªæ— ç¬¦å·ï¼Œå¯ä»¥ç”¨ mulhsu æŒ‡ä»¤ã€‚åœ¨ä¸€æ¡æŒ‡ä»¤ä¸­å®ŒæˆæŠŠ 64 ä½ç§¯å†™å…¥ä¸¤ä¸ª 32ä½å¯„å­˜å™¨çš„æ“ä½œä¼šä½¿ç¡¬ä»¶è®¾è®¡å˜å¾—å¤æ‚ï¼Œæ‰€ä»¥ RV32M éœ€è¦ä¸¤æ¡ä¹˜æ³•æŒ‡ä»¤æ‰èƒ½å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„ 64 ä½ç§¯ã€‚</li>
</ul>
</li>
</ul>
<h3 id="åŸºäºç®—æœ¯è¿ç®—æŒ‡ä»¤å®ç°çš„å…¶ä»–ä¼ªæŒ‡ä»¤"><a href="#åŸºäºç®—æœ¯è¿ç®—æŒ‡ä»¤å®ç°çš„å…¶ä»–ä¼ªæŒ‡ä»¤" class="headerlink" title="åŸºäºç®—æœ¯è¿ç®—æŒ‡ä»¤å®ç°çš„å…¶ä»–ä¼ªæŒ‡ä»¤"></a>åŸºäºç®—æœ¯è¿ç®—æŒ‡ä»¤å®ç°çš„å…¶ä»–ä¼ªæŒ‡ä»¤</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ä¼ªæŒ‡ä»¤</th>
<th>è¯­æ³•</th>
<th>ç­‰ä»·æŒ‡ä»¤</th>
<th>æŒ‡ä»¤æè¿°</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NEG</code></td>
<td><code>NEG RD, RS</code></td>
<td><code>SUB RD, x0, RS</code></td>
<td>å¯¹ RS ä¸­çš„å€¼å–åå¹¶å°†ç»“æœå­˜æ”¾åœ¨ RD ä¸­</td>
<td>neg x5, x6</td>
</tr>
<tr>
<td><code>MV</code></td>
<td><code>MV RD, RS</code></td>
<td><code>ADDI RD, RS, 0</code></td>
<td>å°† <code>RS</code> ä¸­çš„å€¼æ‹·è´åˆ° <code>RD</code> ä¸­</td>
<td>mv x5, x6</td>
</tr>
<tr>
<td><code>NOP</code></td>
<td><code>NOP</code></td>
<td><code>ADDI x0, x0, 0</code></td>
<td>ä»€ä¹ˆä¹Ÿä¸åš</td>
<td>nop</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="PC-Relative-amp-PC-Absolute"><a href="#PC-Relative-amp-PC-Absolute" class="headerlink" title="PC-Relative &amp; PC-Absolute"></a>PC-Relative &amp; PC-Absolute</h3><p>an instruction with <strong>lui</strong> followed by <strong>jalr</strong> instruction is considered <strong>PC-absolute</strong>, and an instruction with <strong>auipc</strong> followed by <strong>jalr</strong> instruction is considered <strong>PC-relative</strong>.<sup><a href="#fn_1" id="reffn_1">1</a></sup></p>
<blockquote id="fn_1">
<sup>1</sup>. <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/52574537/risc-v-pc-absolute-vs-pc-relative">https://stackoverflow.com/questions/52574537/risc-v-pc-absolute-vs-pc-relative</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<hr>
<h2 id="ç§»ä½è¿ç®—æŒ‡ä»¤-Shifting-Instructions"><a href="#ç§»ä½è¿ç®—æŒ‡ä»¤-Shifting-Instructions" class="headerlink" title="ç§»ä½è¿ç®—æŒ‡ä»¤ (Shifting Instructions)"></a>ç§»ä½è¿ç®—æŒ‡ä»¤ (Shifting Instructions)</h2><h3 id="é€»è¾‘ç§»ä½"><a href="#é€»è¾‘ç§»ä½" class="headerlink" title="é€»è¾‘ç§»ä½"></a>é€»è¾‘ç§»ä½</h3><ul>
<li>å·¦ç§» â€” ä¹˜æ³•</li>
<li><code>SLL</code>, <code>SRL</code>, and <code>SRA</code> perform logical left, logical right, and arithmetic right shifts on the value in register rs1 by the shift amount held in the <strong>lower 5 bits of register <code>rs2</code></strong>.</li>
</ul>
<p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs6ai5jp36j30xs0dmdjl.jpg" alt="image-20210705041842923"></em></p>
<h4 id="SLLI"><a href="#SLLI" class="headerlink" title="SLLI"></a>SLLI</h4><ul>
<li><p>Used to <strong>access elements in the array</strong></p>
</li>
<li><p>Left shifting a number $N$ bits produces the same result as multiplying the number by <script type="math/tex">2^N</script>. </p>
<ul>
<li><p>Since a multiply instruction is generally more expensive (slower) than a shift instruction, left shifting is used instead of a multiply instruction as an optimization when possible: if one of the operands is a constant power of two.</p>
</li>
<li><p><strong>Example</strong>:</p>
<p><code>slli</code> is used to calculate the <em>offset</em> into the array <code>save</code>. Since <code>i</code> corresponds to <code>x22</code>, then:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slli x10,x22,<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>multiplies the value of <code>i</code> by <em>8</em> (i.e., $2^3$, a power of two) and writes this result to <code>x10</code>.</p>
<p><code>x25</code> indicates the <strong>base address of the array</strong> <code>save</code> â€“ the address of its first element â€“ <code>save[0]</code>. Together with <code>x10</code>, which corresponds to the <em>offset</em>, is used to calculate the address of <code>save[i]</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add  x10,x10,x25</span><br></pre></td></tr></table></figure>
<p>At this point, <code>x10</code> holds the address of <code>save[i]</code>. That element is eventually loaded into <code>x9</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lw   x9, <span class="number">0</span>(x10)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="ç®—æœ¯ç§»ä½"><a href="#ç®—æœ¯ç§»ä½" class="headerlink" title="ç®—æœ¯ç§»ä½"></a>ç®—æœ¯ç§»ä½</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs9xhfvc1oj31020c0ady.jpg" alt="image-20210708075032310" style="zoom:80%;" /></p>
<hr>
<h2 id="å†…å­˜è¯»å†™æŒ‡ä»¤"><a href="#å†…å­˜è¯»å†™æŒ‡ä»¤" class="headerlink" title="å†…å­˜è¯»å†™æŒ‡ä»¤"></a>å†…å­˜è¯»å†™æŒ‡ä»¤</h2><h3 id="å†…å­˜è¯»-Load"><a href="#å†…å­˜è¯»-Load" class="headerlink" title="å†…å­˜è¯» (Load)"></a>å†…å­˜è¯» (Load)</h3><ul>
<li><code>sw rs2, imm(rs1)</code><ul>
<li>æŠŠ<code>rs2</code>è¯»å†™åˆ°åœ°å€ä¸º<code>imm+rs1</code>çš„å†…å­˜é‡Œ</li>
</ul>
</li>
<li><p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7e4qwbp0j30zm0ckgry.jpg" alt="image-20210706030944037"></em></p>
</li>
<li><p>ç”¨äº function call å¼€å¤´ (prologue)</p>
</li>
<li><p>Example:</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Prologue</span><br><span class="line">addi sp, sp, -<span class="number">36</span></span><br><span class="line">sw s2, <span class="number">0</span>(sp)            # num of elems</span><br><span class="line">sw s3, <span class="number">4</span>(sp) </span><br><span class="line">sw s4, <span class="number">8</span>(sp)</span><br><span class="line">sw s5, <span class="number">12</span>(sp)</span><br><span class="line">sw s6, <span class="number">16</span>(sp)</span><br><span class="line">sw s7, <span class="number">20</span>(sp)</span><br><span class="line">sw s8, <span class="number">24</span>(sp)</span><br><span class="line">sw s9, <span class="number">28</span>(sp)</span><br><span class="line">sw s10, <span class="number">32</span>(sp)</span><br><span class="line">addi s2, a2, <span class="number">0</span> </span><br><span class="line">addi s3, a0, <span class="number">0</span> </span><br><span class="line">addi s4, a1, <span class="number">0</span> </span><br><span class="line">addi s5, x0, <span class="number">0</span> </span><br><span class="line">addi s6, a3, <span class="number">0</span> </span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="å†…å­˜å†™-store"><a href="#å†…å­˜å†™-store" class="headerlink" title="å†…å­˜å†™ (store)"></a>å†…å­˜å†™ (store)</h3><ul>
<li>æŠŠæ•°æ®å¾€å¤–æ”¾</li>
<li>å¯„å­˜å™¨é‡Œæœ‰å››ä¸ªå­—èŠ‚ï¼Œå¤–é¢æœ‰ä¸€ä¸ªå­—èŠ‚</li>
</ul>
<p><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs6f456bcij310a0dc0yo.jpg" alt="image-20210705065812410"></em></p>
<hr>
<h3 id="æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆUnconditional-Jump-Instructionsï¼‰"><a href="#æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆUnconditional-Jump-Instructionsï¼‰" class="headerlink" title="æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆUnconditional Jump Instructionsï¼‰"></a>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼ˆUnconditional Jump Instructionsï¼‰</h3><p>å¦‚æœè·³è½¬åä¸éœ€è¦è¿”å›ï¼Œå¯ä»¥åˆ©ç”¨ x0 ä»£æ›¿ JAL å’Œ JALR ä¸­çš„ RD</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><em>ä¼ªæŒ‡ä»¤</em></th>
<th><em>è¯­æ³•</em></th>
<th><em>ç­‰ä»·æŒ‡ä»¤</em></th>
<th><em>ä¾‹å­</em></th>
</tr>
</thead>
<tbody>
<tr>
<td><em>J</em></td>
<td><em>J OFFSET</em></td>
<td><em>JAL X0, OFFSET</em></td>
<td><em>j leap</em></td>
</tr>
<tr>
<td><em>JR</em></td>
<td><em>JR RS</em></td>
<td><em>JALR X0, 0(RS)</em></td>
<td><em>jr x2</em></td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="åˆ†æ”¯è·³è½¬æŒ‡ä»¤"><a href="#åˆ†æ”¯è·³è½¬æŒ‡ä»¤" class="headerlink" title="åˆ†æ”¯è·³è½¬æŒ‡ä»¤"></a>åˆ†æ”¯è·³è½¬æŒ‡ä»¤</h2><h3 id="æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ï¼ˆConditional-Branch-Instructionsï¼‰"><a href="#æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ï¼ˆConditional-Branch-Instructionsï¼‰" class="headerlink" title="æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ï¼ˆConditional Branch Instructionsï¼‰"></a>æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ï¼ˆConditional Branch Instructionsï¼‰</h3><ul>
<li><em><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs7egavjmsj30wq0g4qbr.jpg" alt="image-20210706032055663"></em></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>ä¼ªæŒ‡ä»¤</th>
<th>è¯­æ³•</th>
<th>ç­‰ä»·æŒ‡ä»¤</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>BLE</td>
<td>BLE RS, RT, OFFSET</td>
<td>BGE RT, RS, OFFSET</td>
<td>Branch if Less &amp; Equalï¼Œæœ‰ç¬¦å·æ–¹å¼æ¯”è¾ƒï¼Œå¦‚æœ RS &lt;= RTï¼Œè·³ è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BLEU</td>
<td>BLEU RS, RT, OFFSET</td>
<td>BGEU RT, RS, OFFSET</td>
<td>Branch if Less or Equal Unsignedï¼Œæ— ç¬¦å·æ–¹å¼æ¯”è¾ƒï¼Œå¦‚æœ RS &lt;= RTï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BGT</td>
<td>BGT RS, RT, OFFSET</td>
<td>BLT RT, RS, OFFSET</td>
<td>Branch if Greater Thanï¼Œæœ‰ç¬¦å·æ–¹å¼æ¯”è¾ƒï¼Œå¦‚æœ RS &gt; RTï¼Œè·³ è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BGTU</td>
<td>BGTU RS, RT, OFFSET</td>
<td>BLTU RT, RS, OFFSET</td>
<td>Branch if Greater Than Unsignedï¼Œæ— ç¬¦å·æ–¹å¼æ¯”è¾ƒï¼Œå¦‚æœ RS &gt; RTï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BEQZ</td>
<td>BEQZ RS, OFFSET</td>
<td>BEQ RS, x0, OFFSET</td>
<td>Branch if EQual Zero, å¦‚æœ RS == 0ï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BNEZ</td>
<td>BNEZ RS, OFFSET</td>
<td>BNE RS, x0, OFFSET</td>
<td>Branch if Not Equal Zero, å¦‚æœ RS != 0ï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BLTZ</td>
<td>BLTZ RS, OFFSET</td>
<td>BLT RS, x0, OFFSET</td>
<td>Branch if Less Than Zero, å¦‚æœ RS &lt; 0ï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BLEZ</td>
<td>BLEZ RS, OFFSET</td>
<td>BGE x0, RS, OFFSET</td>
<td>Branch if Less or Equal Zero, å¦‚æœ RS &lt;= 0ï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BGTZ</td>
<td>BGTZ RS, OFFSET</td>
<td>BLT x0, RS, OFFSET</td>
<td>Branch if Greater Than Zeroï¼Œ å¦‚æœ RS &gt; 0ï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
<tr>
<td>BGEZ</td>
<td>BGEZ RS, OFFSET</td>
<td>BGE RS, x0, OFFSET</td>
<td>Branch if Greater or Equal Zero, å¦‚æœ RS &gt;= 0ï¼Œè·³è½¬åˆ° OFFSET</td>
</tr>
</tbody>
</table>
</div>
<h3 id="RISC-V-Features-n-times-16-bit-Instructions"><a href="#RISC-V-Features-n-times-16-bit-Instructions" class="headerlink" title="RISC-V Features, $n\times 16$-bit Instructions"></a>RISC-V Features, $n\times 16$-bit Instructions</h3><ul>
<li><p>Extensions to RISC-V base ISA support 16-bit compressed instructions and also variable-length instructions that are multiples of 16-bits in length</p>
</li>
<li><p>To enable this, RISC-V <strong>scales the branch offset by 2 bytes</strong> even when there are no 16-bit instructions</p>
</li>
<li><p>Reduces branch reach by half and means that 1/2 of possible targets will be errors on RISC-V processors that only support 32-bit instructions (as used in this class)</p>
</li>
<li><p>RISC-V conditional branches can only reach $Â±\;2^{10} Ã— 32$-bit instructions on either side of PC</p>
</li>
</ul>
<hr>
<h2 id="RISC-V-Immediates"><a href="#RISC-V-Immediates" class="headerlink" title="RISC-V Immediates"></a>RISC-V Immediates</h2><ul>
<li><p><strong>==Immediates==</strong> are <strong>numerical constants</strong>.</p>
</li>
<li><p>They appear often in code, so there are <strong>special instructions</strong> for them.</p>
</li>
<li><p>Add Immediate using <code>addi</code>:</p>
<p><strong><code>addi x3,x4,10</code></strong> (in RISC-V)</p>
<p><code>f = g + 10</code> (in C)</p>
<p>where RISC-V registers <strong>x3</strong>,<strong>x4</strong> are associated with C variables f, g</p>
</li>
<li><p>Syntax similar to add instruction, except that last argument is a number instead of a register.</p>
</li>
<li><p>Always <strong>sign-extended</strong> to make 32-bit instructions</p>
</li>
</ul>
<h3 id="No-Subtract-Immediate"><a href="#No-Subtract-Immediate" class="headerlink" title="No Subtract Immediate"></a>No Subtract Immediate</h3><ul>
<li>There is no Subtract Immediate in RISC-V: Why?<ul>
<li>There are <strong>add</strong> and <strong>sub</strong>, but no <strong>addi</strong> counterpart</li>
</ul>
</li>
<li>Limit types of operations that can be done to absolute minimum<ul>
<li>if an operation can be decomposed into a simpler operation, donâ€™t include it</li>
<li>addi â€¦, -x = â€œsubi â€¦, xâ€ =&gt; so no â€œsubiâ€<ul>
<li><strong><code>addi x3,x4,-10</code></strong> (in RISC-V)</li>
<li><code>f = g - 10</code> (in C)</li>
</ul>
</li>
<li>where RISC-V registers <strong>x3</strong>,<strong>x4</strong> are associated with C variables f, g, respectively</li>
</ul>
</li>
</ul>
<h3 id="Register-Zero"><a href="#Register-Zero" class="headerlink" title="Register Zero"></a>Register Zero</h3><ul>
<li>One particular immediate, the number zero (0), appears very often in code.</li>
<li>So the register zero (x0) is â€˜hard-wiredâ€™ to value 0; e.g.<ul>
<li><strong><code>add x3,x4,x0</code></strong> (in RISC-V)</li>
<li><code>f = g</code> (in C)</li>
<li>where RISC-V registers <strong>x3</strong>,<strong>x4</strong> are associated with C variables f, g</li>
</ul>
</li>
<li>Defined in hardware, so an instruction <strong>add x0,x3,x4</strong> will not do anything!</li>
</ul>
<hr>
<h2 id="Memory-Addresses-are-in-Bytes"><a href="#Memory-Addresses-are-in-Bytes" class="headerlink" title="Memory Addresses are in Bytes"></a>Memory Addresses are in Bytes</h2><ul>
<li>Data typically smaller than 32 bits, but rarely smaller than 8 bits (e.g., char type)â€“works fine if everything is a multiple of 8 bits</li>
<li>8 bit chunk is called a byte (1 word = 4 bytes)</li>
<li>Memory addresses are really in bytes, not words</li>
<li>Word addresses are 4 bytes apart<ul>
<li>Word address is same as address of rightmost byte â€“ least-significant byte (i.e. Little-endian convention)</li>
</ul>
</li>
<li>Data typically smaller than 32 bits, but rarely smaller than 8 bits (e.g., char type)â€“works fine if everything is a multiple of 8 bits</li>
<li>8 bit chunk is called a byte (1 word = 4 bytes)</li>
<li>Memory addresses are really in bytes, not words</li>
<li>Word addresses are 4 bytes apart</li>
<li>Word address is same as address of rightmost byte â€“ least-significant byte (i.e. Little-endian convention)</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Shuo
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="http://shuoo-24.github.io/2021/06/30/hello-world/" title="RISC-V Instruction Overview">http://shuoo-24.github.io/2021/06/30/hello-world/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Computer-Architecture/" rel="tag"># Computer Architecture</a>
              <a href="/tags/RISC-V/" rel="tag"># RISC-V</a>
              <a href="/tags/ISA/" rel="tag"># ISA</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/2021/06/30/%E7%9F%A5%E8%AF%86%E8%BF%9B%E6%AD%A5%E7%9A%84%E7%8A%80%E5%88%A9%E5%B7%A5%E5%85%B7%EF%BC%9A%E7%90%86%E8%AE%BA%E7%9A%84%E6%94%B6%E7%9B%8A%E5%92%8C%E6%88%90%E6%9C%AC/" rel="next" title="çŸ¥è¯†è¿›æ­¥çš„çŠ€åˆ©å·¥å…·ï¼šç†è®ºçš„æ”¶ç›Šå’Œæˆæœ¬">
                  çŸ¥è¯†è¿›æ­¥çš„çŠ€åˆ©å·¥å…·ï¼šç†è®ºçš„æ”¶ç›Šå’Œæˆæœ¬ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shuo</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  















  








  

  

</body>
</html>
